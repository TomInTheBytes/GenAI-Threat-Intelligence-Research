# Reference for threat actor for "OilRig, APT 34, Helix Kitten, Chrysene"

**Title**: APT34 Deploys Phishing Attack With New Malware

**Source**: https://www.trendmicro.com/en_fi/research/23/i/apt34-deploys-phishing-attack-with-new-malware.html

## Content























APT34 Deploys Phishing Attack With New Malware

































Business



search
close










Solutions



By Challenge





By Challenge





By Challenge
Learn more








Understand, Prioritize & Mitigate Risks





Understand, Prioritize & Mitigate Risks
Improve your risk posture with attack surface management
Learn more








Protect Cloud-Native Apps





Protect Cloud-Native Apps
Security that enables business outcomes
Learn more








Protect Your Hybrid World





Protect Your Hybrid, Multi-Cloud World
Gain visibility and meet business needs with security
Learn more








Securing Your Borderless Workforce





Securing Your Borderless Workforce
Connect with confidence from anywhere, on any device
Learn more








Eliminate Network Blind Spots





Eliminate Network Blind Spots
Secure users and key operations throughout your environment
Learn more








See More. Respond Faster.





See More. Respond Faster.
Move faster than your adversaries with powerful purpose-built XDR, attack surface risk management, and zero trust capabilities
Learn more








Extend Your Team





Extend Your Team. Respond to Threats Agilely
Maximize effectiveness with proactive risk reduction and managed services
Learn more








Operationalizing Zero Trust





Operationalizing Zero Trust
Understand your attack surface, assess your risk in real time, and adjust policies across network, workloads, and devices from a single console
Learn more










By Role





By Role





By Role
Learn more








CISO





CISO
Drive business value with measurable cybersecurity outcomes
Learn more








SOC Manager





SOC Manager
See more, act faster
Learn more








Infrastructure Manager





Infrastructure Manager
Evolve your security to mitigate threats quickly and effectively
Learn more








Cloud Builder and Developer





Cloud Builder and Developer
Ensure code runs only as intended
Learn more








Cloud Security Ops





Cloud Security Ops
Gain visibility and control with security designed for cloud environments
Learn more










By Industry





By Industry





By Industry
Learn more








Healthcare





Healthcare
Protect patient data, devices, and networks while meeting regulations
Learn more








Manufacturing





Manufacturing
Protecting your factory environments – from traditional devices to state-of-the-art infrastructures
Learn more








Oil & Gas





Oil & Gas
ICS/OT Security for the oil and gas utility industry
Learn more








Electric Utility





Electric Utility
ICS/OT Security for the electric utility
Learn more








Automotive





Automotive
Learn more








5G Networks





5G Networks
Learn more








Financial Services





Financial Services
Discover how to innovate securely in the cloud
Learn more








Public Sector





Public Sector
Cybersecurity to protect citizen data
Learn more








Retail





Retail
Learn more










Small & Midsized Business Security





Small & Midsized Business Security
Stop threats with comprehensive, set-it-and-forget-it protection
Learn more










Platform



Vision One Platform





Vision One Platform





Trend Vision One
Our Unified Platform
Bridge threat protection and cyber risk management
Learn more









AI Companion





Trend Vision One Companion
Your generative AI cybersecurity assistant
Learn more










Attack Surface Management





Attack Surface Management
Operationalize a zero trust strategy
Learn more









XDR (Extended Detection & Response)





XDR (Extended Detection & Response)
Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform
Learn more









Endpoint Security





Endpoint Security





Endpoint Security Overview
Defend the endpoint through every stage of an attack
Learn more








Industrial Endpoint Security





Industrial Endpoint Security
Learn more








Workload Security





Workload Security
Optimized prevention, detection, and response for endpoints, servers, and cloud workloads
Learn more








Mobile Security





Mobile Security
On-premises and cloud protection against malware, malicious applications, and other mobile threats
Learn more









XDR for Endpoint





XDR for Endpoint
Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform
Learn more











Cloud Security





Cloud Security





Trend Vision One™
Cloud Security Overview
The most trusted cloud security platform for developers, security teams, and businesses
Learn more








Container Security





Container Security
Simplify security for your cloud-native applications with advanced container image scanning, policy-based admission control, and container runtime protection
Learn more









File Storage Security





File Storage Security
Security for cloud file/object storage services leveraging cloud-native application architectures
Learn more









Attack Surface Risk Management for Cloud





Attack Surface Risk Management for Cloud
Proactively discover, assess, and reduce cyber risk
Learn more








XDR for Cloud





XDR for Cloud
Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform
Learn more











Network Security





Network Security





Network Security Overview
Expand the power of XDR with network detection and response
Learn more








Network Intrusion Prevention (IPS)





Network Intrusion Prevention (IPS)
Protect against known, unknown, and undisclosed vulnerabilities in your network
Learn more








Breach Detection System (BDS)





Breach Detection System (BDS)
Detect and respond to targeted attacks moving inbound, outbound, and laterally
Learn more








Secure Service Edge (SSE)





Secure Service Edge (SSE)
Redefine trust and secure digital transformation with continuous risk assessments
Learn more









Industrial Network Security





Industrial Network Security
Learn more








XDR for Network





XDR for Network
Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform
Learn more









5G Network Security





5G Network Security
Learn more










Email Security





Email Security





Email Security
Stop phishing, malware, ransomware, fraud, and targeted attacks from infiltrating your enterprise
Learn more








Email and Collaboration Security





Trend Vision One™
Email and Collaboration Security
Stop phishing, ransomware, and targeted attacks on any email service including Microsoft 365 and Google Workspace
Learn more











Threat Intelligence





Threat Intelligence
Keep ahead of the latest threats and protect your critical data with ongoing threat prevention and analysis
Learn more








All Products, Services, and Trials





All Products, Services, and Trials
Learn more









OT Security





OT Security





OT Security
Learn about solutions for ICS / OT security.
Learn more








Industrial Endpoint Security





Industrial Endpoint Security
Learn more








Industrial Network Security





Industrial Network Security
Industrial Network Security








XDR for OT





XDR for OT
Stop adversaries faster with a broader perspective and better context to hunt, detect, investigate, and respond to threats from a single platform
Learn more













Research



Research





Research





Research
Learn more








Research, News, and Perspectives





Research, News, and Perspectives
Learn more








Research and Analysis





Research and Analysis
Learn more








Security News





Security News
Learn more








Zero Day Initiatives (ZDI)





Zero Day Initiatives (ZDI)
Learn more












Services



Our Services





Our Services





Our Services
Learn more








Service Packages





Service Packages
Augment security teams with 24/7/365 managed detection, response, and support
Learn more








Managed XDR





Managed XDR
Augment threat detection with expertly managed detection and response (MDR) for email, endpoints, servers, cloud workloads, and networks
Learn more








Incident Response





Incident Response





Incident Response
Our trusted experts are on call whether you're experiencing a breach or looking to proactively improve your IR plans
Learn more








Insurance Carriers and Law Firms





Insurance Carriers and Law Firms
Stop breaches with the best response and detection technology on the market and reduce clients’ downtime and claim costs
Learn more










Support Services





Support Services
Learn more












Partners



Partner Program





Partner Program





Partner Program Overview
Grow your business and protect your customers with the best-in-class complete, multilayered security
Learn more








Managed Service Provider





Managed Service Provider
Partner with a leading expert in cybersecurity, leverage proven solutions designed for MSPs
Learn more








Cloud Service Provider





Cloud Service Provider
Add market-leading security to your cloud service offerings – no matter which platform you use
Learn more








Professional Services





Professional Services
Increase revenue with industry-leading security
Learn more








Resellers





Resellers
Discover the possibilities
Learn more








Marketplace





Marketplace
Learn more








System Integrators





System Integrators
Learn more








Managed Security Service Provider





Managed Security Service Provider
Deliver modern security operations services with our industry-leading XDR
Learn more










Alliance Partners





Alliance Partners





Alliance Overview
We work with the best to help you optimize performance and value
Learn more








Technology Alliance Partners





Technology Alliance Partners
Learn more








Our Alliance Partners





Our Alliance Partners
Learn more










Partner Tools





Partner Tools





Partner Tools
Learn more








Partner Login





Partner Login
Login








Education and Certification





Education and Certification
Learn more








Partner Successes





Partner Successes
Learn more








Distributors





Distributors
Learn more








Find a Partner





Find a Partner
Learn more












Company



Why Trend Micro





Why Trend Micro





Why Trend Micro
Learn more








Customer Success Stories





Customer Success Stories
Learn more








Industry Accolades





Industry Accolades
Learn more








Strategic Alliances





Strategic Alliances
Learn more








Compare Trend Micro





Compare Trend Micro
Learn more










About Us





About Us





About Us
Learn more








Trust Center





Trust Center
Learn more








History





History
Learn more








Diversity, Equity and Inclusion





Diversity, Equity and Inclusion
Learn more








Corporate Social Responsibility





Corporate Social Responsibility
Learn more








Leadership





Leadership
Learn more








Security Experts





Security Experts
Learn more








Internet Safety and Cybersecurity Education





Internet Safety and Cybersecurity Education
Learn more








Legal





Legal
Learn more








Investors





Investors
Learn more








Formula E Racing





Formula E Racing
Learn more










Latest News





Latest News





Latest News
Learn more








Newsroom





Newsroom
Learn more








Events





Events
Learn more








Careers





Careers
Learn more








Webinars





Webinars
Learn more










End of Support





End of Support
Patch management is a fundamental component for handling vulnerabilities
Learn more












Back





Back





Back





Back







		Free Trials
	



		Contact Us
	






Looking for home solutions?

Under Attack?




1 Alerts





Back




Unread
All








The Microsoft Defender SmartScreen Vulnerability

close



The facts, and why our customers are safe >










Support




			Business Support Portal
		



			Business Community
		



			Virus and Threat Help
		



			Education and Certification
		



			Contact Support
		



			Find a Support Partner
		





Resources




			Cyber Risk Index/Assessment
		



			CISO Resource Center
		



			DevOps Resource Center
		



			What Is?
		



			Threat Encyclopedia
		



			Cloud Health Assessment
		



			Cyber Insurance
		



			Glossary of Terms
		



			Webinars
		





Log In




			Support
		



			Partner Portal
		



			Cloud One
		



			Product Activation and Management
		



			Referral Affililate
		







Back











arrow_back

search













close






Content has been added to your Folio


				Go to Folio (0)
			
close











APT & Targeted Attacks
APT34 Deploys Phishing Attack With New Malware
We observed and tracked the advanced persistent threat (APT) APT34 group with a new malware variant accompanying a phishing attack comparatively similar to the SideTwist backdoor malware. Following the campaign, the group abused a fake license registration form of an African government agency to target a victim in Saudi Arabia.
By: Mohamed Fahmy, Mahmoud Zohdy
		
			September 29, 2023
Read time:  ( words)
	















Save to Folio






 Subscribe












We analyzed a new malware, which we attribute to the APT34 advanced persistent threat (APT) group, that was involved in a phishing attack. In August, our threat hunting activities identified a malicious document we investigated to have been used during a targeted phishing attack by the group. The malicious document is responsible for dropping a new malware we have called Menorah (taken from the malicious document’s dropped executable, detected by Trend Micro as Trojan.W97M.SIDETWIST.AB), and for creating a scheduled task for persistence. The malware was designed for cyberespionage, capable of identifying the machine, reading and uploading files from the machine, and downloading another file or malware.
During our investigation, there was little information about the victims targeted by this malware. But the file that APT34 used for this attack is called “MyCv.doc,” a license registration form related to the Seychelles Licensing Authority. However, we noted that the document contained pricing information in Saudi Riyal, which might indicate that the targeted victim was an organization inside the Kingdom of Saudi Arabia. This blog post provides an analysis of the group’s latest malware and its capabilities, shows the attack process, and details the attackers’ infrastructure.
APT34 background and targeting
APT34 is a covert cyberespionage group that specializes in targeting organizations and illicit activities within the Middle East. As we’ve previously covered, APT34 primarily focuses on collecting sensitive intelligence, employing spear phishing campaigns, and abusing advanced techniques to infiltrate and maintain access within targeted networks. Our monitoring suggests this group operates with a high degree of sophistication and seemingly vast resources, posing a significant cybersecurity challenge regionally and beyond.
Notably, APT34 has been involved in high-profile cyberattacks against a diverse range of targets in the Middle East, including government agencies, critical infrastructure, telecommunications, and key regional entities. The group consistently develops and enhances tools, aiming to reduce security solutions and researchers’ detection. In this research on APT34, we observed the group transitioning to the employment of novel data exfiltration methods. Researchers from NSFOCUS published a report on a new variant of the SideTwist malware utilized by APT34.
Infection routine






Figure 1. Malware infection routine (Click on the button to download the infection chain)


download








The infection starts with a malicious document dropping a hardcoded malware and creates a scheduled task for persistence once the targeted victim opens the document. The malicious document contains hidden macros responsible for dropping a .NET malware into the <%ALLUSERSPROFILE%\Office356> directory, naming it Menorah.exe. It then creates a scheduled task named "OneDriveStandaloneUpdater" to execute the Menorah.exe malware. The image in Figure 2 shows a portion of the macros' functions responsible for string transformation, decoding, and the creation of the scheduled task.






Figure 2. Macros for string transformation







Figure 3. Creating a scheduled tasks to execute the Menorah.exe malware





Malware analysis
The .NET-written malware delivered through the malicious document is primarily deployed for cyberespionage and possesses multifaceted capabilities. The malware can fingerprint the targeted machine, list directories and files, upload selected files from the compromised system, execute shell commends, and download files to the system.
Compared to the previous variant of SideTwist, the new variant has more functions to hash the traffic to the command and control (C&C) server and make it stealthier to avoid detection. Initially, the malware conducts a specific argument check during execution to ensure the correct flow of its operations. In the absence of the specified argument, the malware will terminate and stop its execution. The regular check ensures the routine’s and components’ stealth, and detects if the malware is in an analytic environment like a sandbox. If the argument determines that it’s running inside a sandbox, the malware will run without the argument and terminate itself.






Figure 4. Checking for a specific argument





We identified the C&C server, http[:]//tecforsc-001-site1[.]gtempurl.com/ads.asp, as a string subsequently used for HTTP communication and to create a timer to repeat a specific code every 32,000 milliseconds (or every 32 seconds) as a way to organize communication with the C&C server.
Then, the malware fingerprints the machine by getting the machine name and username in this format: {MachineNameUsername}. The malware continues to encode the string into ASCII then calculates for the MD5 hash from it. The MD5 hash is combined with the {MachineNameUsername} in the format {‘d@{MD5 hash}@MachineName|Username} XOR with a hardcoded string and encoded in Base64, creating a fingerprint for the compromised system. This fingerprint is sent to the C&C server as the content of an HTTP request, as shown in the figure below.






Figure 5. Identifying the C&C server







Figure 6. Sending the “fingerprint” of the victim system





Unfortunately, the C&C server was inactive at the time of analysis. However, from the analysis for functions responsible for parsing the C&C, we expected that the response returned will be an encrypted massage and further encoded in Base64. The decrypted and decoded message split into an array, and each value inside it represents part of the message received from the C&C server. Based on these values, the malware will have specific actions on the machine.
From static analysis, we observed the malware capable of executing a command received from the C&C server, list directory and files on the compromised system, and upload specific files to server and download files. The following are the malware’s commands, values, and actions:





Table 1. Malware’s functions and commands received from the C&C server
Command ID
Command
Function
1
Command starts with +sp
Malware will receive a command and execute it on the compromised system.
1
Command starts with +f1
Malware will get the files and directories under the base directory.
1
Command starts with +dn
Malware will upload a specific file to the C&C server.
2
 
Malware will download file to the server. 







Figure 7. Decoded message splitting into an array based on the communication received from the C&C server





Similarities to backdoor SideTwist
In 2021, Checkpoint published an article about SideTwist malware written in native language. After comparing both malware variants, we found that there are significant similarities between the two in terms of functionality, especially in the way the malware fingerprints the compromised system and C&C communication. Moreover, SideTwist malware uses the computer name and username to create the unique ID for the victim machine, but the variant in 2021 uses a 4-byte hash instead of MD5 during the ID creation. Both malware variants provide similar backdoor functionalities to execute the shell command, as well as upload and download files.
Conclusions
The similarities to the SideTwist backdoor suggests that APT34 is in continuous-development mode, changing up and trying which routines and techniques will work. Typical of APT groups, APT34 demonstrates their vast resources and varied skills, and will likely persist in customizing routines and social engineering techniques to use per targeted organization to ensure success in intrusions, stealth, and cyber espionage. The earlier variant of SideTwist is written in C, and this latest variant has a very similar set of functions but in a .NET implementation.
While the techniques and malware infection routine in this sample are not on the same level of sophistication as the previously documented attacks of the group, the techniques still work as they continue to redo and depend on them. As previous reports on APT34 have noted, the group uses simple routines and changes that, for security analysts and researchers, don’t take long to track and analyze. But the group’s arsenal and skills enable them to rapidly create new pieces of malware and tools, allowing the group to continuously deploy in successive cycles. Organizations should continuously warn and keep their employees aware of the different techniques that attackers employ to target systems, proprietary, and personal information.
Indicators of Compromise (IOCs)





SHA256
Detections
8a8a7a506fd57bde314ce6154f2484f280049f2bda504d43704b9ad412d5d618
Trojan.W97M.SIDETWIST.AB
64156f9ca51951a9bf91b5b74073d31c16873ca60492c25895c1f0f074787345
Trojan.MSIL.SIDETWIST.AA





URL
hxxp://tecforsc-001-site1[.]gtempurl[.]com/ads.asp




Tags

Malware
|
Phishing
|
Cyber Threats
|
APT & Targeted Attacks
|
Endpoints
|
Network
|
Articles, News, Reports





	
		Authors
	





Mohamed Fahmy
Threat Researcher




Mahmoud Zohdy
Threat Researcher





		Contact Us
	



		Subscribe
	






Related Articles



					CVE-2024-21412: Water Hydra Targets Traders With Microsoft Defender SmartScreen Zero-Day
				



					SmartScreen Vulnerability: CVE-2024-21412 Facts and Fixes
				



					Global Cybersecurity Trends: AI, Geopolitical Risks, and Zero Trust
				






				See all articles
			




























Try our services free for 30 days






		Start your free trial today
	






















































Resources

Blog
Newsroom
Threat Reports
DevOps Resource Center
CISO Resource Center
Find a Partner






Support

Business Support Portal
Contact Us
Downloads
Free Trials








About Trend

About Us
Careers
Locations
Upcoming Events
Trust Center














Select a country / region




			expand_more


close

The Americas


United States


Brasil


Canada


México




Middle East & Africa


South Africa


Middle East and North Africa




Europe


België (Belgium)


Česká Republika


Danmark


Deutschland, Österreich Schweiz


España


France


Ireland


Italia


Nederland


Norge (Norway)


Polska (Poland)


Suomi (Finland)


Sverige (Sweden)


Türkiye (Turkey)


United Kingdom




Asia & Pacific


Australia


Центральная Азия (Central Asia)


Hong Kong (English)


香港 (中文) (Hong Kong) 


भारत गणराज्य (India)


Indonesia


日本 (Japan)


대한민국 (South Korea)


Malaysia


Монголия (Mongolia) and рузия (Georgia)


New Zealand


Philippines


Singapore


台灣 (Taiwan)


 ประเทศไทย (Thailand)


Việt Nam

















Privacy | Legal | Site map





Copyright ©2024 Trend Micro Incorporated. All rights reserved

























sXpIBdPeKzI9PC2p0SWMpUSM2NSxWzPyXTMLlbXmYa0R20xk






