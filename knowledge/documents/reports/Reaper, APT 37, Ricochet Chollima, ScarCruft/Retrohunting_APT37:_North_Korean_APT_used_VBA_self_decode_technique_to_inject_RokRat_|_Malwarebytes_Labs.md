# Reference for threat actor for "Reaper, APT 37, Ricochet Chollima, ScarCruft"

**Title**: Retrohunting APT37: North Korean APT used VBA self decode technique to inject RokRat | Malwarebytes Labs

**Source**: https://blog.malwarebytes.com/threat-analysis/2021/01/retrohunting-apt37-north-korean-apt-used-vba-self-decode-technique-to-inject-rokrat/

## Content











Retrohunting APT37: North Korean APT used VBA self decode technique to inject RokRat | Malwarebytes Labs








































 




 








Skip to content





Search

Search Malwarebytes.com



Search for:








Contact Us

Personal Support
Business Support
Talk to Sales
Contact Press
Partner Programs
Submit Vulnerability


Company

About Malwarebytes
Careers
News & Press


Sign In

MyAccount sign in: manage your personal or Teams subscription >
Cloud Console sign in: manage your cloud business products >
Partner Portal sign in: management for Resellers and MSPs >


 














Personal


< Personal

ProductsMalwarebytes Premium >Malwarebytes Privacy VPN >Malwarebytes Identity Theft Protection >Malwarebytes Browser Guard >Malwarebytes for Teams/small offices >AdwCleaner for Windows >

Find the right productSee our plansInfected already?Clean your device now




SolutionsFree antivirus >Free virus scan & removal >Windows antivirus >Mac antivirus >Android antivirus >iOS security >Chromebook antivirus >
See personal pricingManage your subscriptionVisit our support page 





Business


< Business
BUNDLESCorePrevent and remediate threats and identify vulnerabilitiesAdvancedUtilize threat guidance and patch management plus everything in CoreEliteDeploy Managed Detection and Response plus everything in AdvancedUltimateProtect against categories of malicious websites plus everything in Elite


TECHNOLOGY HIGHLIGHTSManaged Detection & Response (MDR) Deploy fully-managed threat monitoring, investigation, and remediationEndpoint Detection & Response (EDR)Prevent more attacks with security that catches what others missSecurity AdvisorVisualize and optimize your security posture in just minutesFor EducationSecure your students and institution against cyberattacks







Learn more about Security Advisor (available in every bundle) and see the full list of our products and services.
Full technology list >




Pricing



< Pricing
Personal pricingProtect your personal devices and dataSmall office/home office pricingProtect your team’s devices and dataBusiness pricingExplore our award-winning endpoint security products, from EP to EDR to MDR




Partners



< Partners
Explore PartnershipsPartner SolutionsResellersManaged Service ProvidersComputer RepairTechnology PartnersAffiliate PartnersContact Us




Resources


< Resources
Learn About CybersecurityAntivirusMalwareRansomwareMalwarebytes Labs – BlogGlossaryThreat Center


Business ResourcesReviewsAnalyst ReportsCase StudiesPress & News


ReportsThe State of Malware 2023 ReportRead report



Support



< Support
Technical SupportPersonal SupportBusiness SupportPremium ServicesForumsVulnerability DisclosureReport a False Positive


Featured ContentActivate Malwarebytes Privacy on Windows device.See Content Product Videos



 

Free Download




Search
Search

Search Malwarebytes.com



Search for:









































SUBSCRIBE


rss

































 


News
						 | 						Scams
						 | 						Threats

Retrohunting APT37: North Korean APT used VBA self decode technique to inject RokRat 
Posted: January 6, 2021
 by Threat Intelligence Team 


This post was authored by Hossein Jazi On December 7 2020 we identified a malicious document uploaded to Virus Total which was purporting to be a meeting request likely used to target the government of South Korea. The meeting date mentioned in the document was 23 Jan 2020, which aligns with the document compilation time of 27 Jan 2020, indicating that this attack took place almost a year ago. The file contains an embedded macro that uses a VBA self decoding technique to decode itself within the memory spaces of Microsoft Office without writing to the disk. It then embeds a variant of the RokRat into Notepad. Based on the injected payload, we believe that this sample is associated with APT37. This North Korean group is also known as ScarCruft, Reaper and Group123 and has been active since at least 2012, primarily targeting victims in South Korea. In the past, this APT has relied on Hangul Office documents (hwp files) to target victims, as it’s software that’s commonly used in South Korea. However, in this blog we describe an interesting alternative method, delivered via self-decoding VBA Office files. To the best of our knowledge, this is a first for this APT group. Document analysis The actor used the VBA self-decoding concept in its macro that was first introduced in 2016. A malicious macro is encoded within another that is then decoded and executed dynamically.  Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 After bypassing VBOM, it calls another function which creates a Mutex in the victims’s machine by calling CreateMutexA API call and names it “mutexname”. This has been used by the actor to make sure it infects the victim only once.     Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 “fngjksnhokdnfd” is called with one parameter to bypass VBOM. This function sets the VBOM registry key to one.    After bypassing VBOM, it calls another function which creates a Mutex in the victims’s machine by calling CreateMutexA API call and names it “mutexname”. This has been used by the actor to make sure it infects the victim only once.     Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Microsoft by default disables the dynamic execution of the macro, and if an attacker needs to execute one dynamically—which is the case here—the threat actor needs to bypass the VB object model (VBOM) by modifying its registry value. To check if it can bypass the VBOM, it looks to see if the VBOM can be accessed or not. The “ljojijbjs” function is used for this purpose and checks read access to the VBProject.VBComponent. If it triggers an exception, it means the VBOM needs to be bypassed (IF clause). If there is no exception, it means the VBOM is already bypassed and VBA can extract its macro dynamically (Else clause).    “fngjksnhokdnfd” is called with one parameter to bypass VBOM. This function sets the VBOM registry key to one.    After bypassing VBOM, it calls another function which creates a Mutex in the victims’s machine by calling CreateMutexA API call and names it “mutexname”. This has been used by the actor to make sure it infects the victim only once.     Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 Figure 3 shows the macro used by this document. This macro starts by calling the “ljojijbjs” function, and based on the results will take different paths for execution.    Microsoft by default disables the dynamic execution of the macro, and if an attacker needs to execute one dynamically—which is the case here—the threat actor needs to bypass the VB object model (VBOM) by modifying its registry value. To check if it can bypass the VBOM, it looks to see if the VBOM can be accessed or not. The “ljojijbjs” function is used for this purpose and checks read access to the VBProject.VBComponent. If it triggers an exception, it means the VBOM needs to be bypassed (IF clause). If there is no exception, it means the VBOM is already bypassed and VBA can extract its macro dynamically (Else clause).    “fngjksnhokdnfd” is called with one parameter to bypass VBOM. This function sets the VBOM registry key to one.    After bypassing VBOM, it calls another function which creates a Mutex in the victims’s machine by calling CreateMutexA API call and names it “mutexname”. This has been used by the actor to make sure it infects the victim only once.     Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB
 We can consider this technique an unpacker stub, which is executed upon opening the document. This unpacker stub unpacks the malicious macro and writes it into the memory of Microsoft Office without being written to disk. This can easily bypass several security mechanisms.    Figure 3 shows the macro used by this document. This macro starts by calling the “ljojijbjs” function, and based on the results will take different paths for execution.    Microsoft by default disables the dynamic execution of the macro, and if an attacker needs to execute one dynamically—which is the case here—the threat actor needs to bypass the VB object model (VBOM) by modifying its registry value. To check if it can bypass the VBOM, it looks to see if the VBOM can be accessed or not. The “ljojijbjs” function is used for this purpose and checks read access to the VBProject.VBComponent. If it triggers an exception, it means the VBOM needs to be bypassed (IF clause). If there is no exception, it means the VBOM is already bypassed and VBA can extract its macro dynamically (Else clause).    “fngjksnhokdnfd” is called with one parameter to bypass VBOM. This function sets the VBOM registry key to one.    After bypassing VBOM, it calls another function which creates a Mutex in the victims’s machine by calling CreateMutexA API call and names it “mutexname”. This has been used by the actor to make sure it infects the victim only once.     Finally, in order to perform the self-decoding process, it needs to open itself by creating a new Application object and load the current document in it in invisible mode.     If VBOM is already bypassed, The function Init is called and generates the malicious macro content in obfuscated format.      In the next step, this obfuscated macro is passed to “eviwbejfkaksd” to be de-obfuscated and then executed into memory.    To de-obfuscate the macro, two string arrays have been defined: StringOriginal which contains an array of characters before de-obfuscationStringEncoded which contains an array of characters after de-obfuscation A loop has been defined to de-obfuscate the macro. For each iteration it takes a character in the obfuscated macro and looks for its index in StringEncoded. When it finds its index, it looks for its equivalent index in StringOriginal, takes that character from it and adds it to the new macro. As an example “gm* bf” as encoded macro will be decoded to “Option”.    Following this process gives us the final macro that will be executed in the memory space of Microsoft Office. In order to execute this decoded macro, it creates a module and writes into it before calling its main function to execute the macro.   The main function defines a shellcode in hex format, and a target process which is Notepad.exe. Then, based on the OS version, it creates a Notepad.exe process and allocates memory within its address space using VirtualAlloc. It then writes the shellcode into the allocated memory using WriteProcessMemory. At the end it calls CreateRemoteThread to execute the shellcode within the address space of Notepad.exe.    Shellcode analysis (RokRat): The shellcode injected into Notepad.exe downloads an encrypted payload from http://bit[.]ly/2Np1enh which is redirected to a Google drive link.     Downloaded payload is a variant of a cloud-based RAT known as RokRat which has been used by this group since 2017.  This sample compilation date is 29 Oct 2019. This RAT is known to steal data from a victim’s machine and send them to cloud services (Pcloud, Dropbox, Box, Yandex).    Similar to its previous variants, it uses several anti-analysis techniques to make sure it is not running in an analysis environment. Here are some of the checks: Checking the DLLs related to iDefense SysAnalyzer, Microsoft Debugging DLL and SandboxiesCalling IsDebuggerPresent and GetTickCount to identify a debuggerChecking VMWare related file    This RAT has the following capabilities: Capture ScreenShots    Gather system info (Username, Computer name, BIOS)    Data exfiltration to cloud services    Stealing credentialsFile and directory management For more detailed analysis of this RAT you can refer to the reports from NCC Group and Cisco Talos. Conclusion The primary initial infection vector used by APT37 is spear phishing, in which the actor sends an email to a target that is weaponized with a malicious document. The case we analyzed is one of the few where they did not use Hwp files (Hangul Office) as their phish documents and instead used Microsoft Office documents weaponized with a self decode macro. That technique is a clever choice that can bypass several static detection mechanisms and hide the main intent of a malicious document.  The final payload used by this threat actor is a known custom RAT (RokRat) that the group has used in previous campaigns. In the past, RokRat has been injected into cmd.exe, whereas here they chose Notepad.exe.     Indicators of Compromise Maldoc:3c59ad7c4426e8396369f084c35a2bd3f0caa3ba1d1a91794153507210a77c90 RokRat:676AE680967410E0F245DF0B6163005D8799C84E2F8F87BAD6B5E30295554E08A42844FC9CB7F80CA49726B3589700FA47BDACF787202D0461C753E7C73CFD2A2A253C2AA1DB3F809C86F410E4BD21F680B7235D951567F24D614D8E4D041576C7CCD2AEE0BDDAF0E6C8F68EDBA14064E4A9948981231491A87A277E0047C0CB




SHARE THIS ARTICLE
































RELATED ARTICLES





 



News
																	 | 																	Privacy

Facebook Marketplace users’ stolen data offered for sale


February 15, 2024 - Personal data belonging to 200,000 Facebook Marketplace users has been published online, including email addresses and phone numbers.

CONTINUE READING
 0 Comments






 



Cybercrime
																	 | 																	Ransomware
																	 | 																	Threats

How ransomware changed in 2023


February 14, 2024 - In 2023, the CL0P ransomware gang broke the scalability barrier and shook the security world with a series of short, automated campaigns.

CONTINUE READING
 0 Comments






 



News
																	 | 																	Personal

Malwarebytes crushes malware all the time


February 14, 2024 - The PC Security Channel tested Malwarebytes against 2015 files.  Here's how we did.

CONTINUE READING
 0 Comments






 



Exploits and vulnerabilities
																	 | 																	News

Update now! Microsoft fixes two zero-days on February Patch Tuesday


February 14, 2024 - Microsoft has issued patches for 73 security vulnerabilities in its February 2024 Patch Tuesday.

CONTINUE READING
 0 Comments






 



Android
																	 | 																	News
																	 | 																	Personal

TheTruthSpy stalkerware, still insecure, still leaking data


February 13, 2024 - Stalkerware app TheTruthSpy has been hacked for the fourth time, once again leaking the sensitive data it captures.

CONTINUE READING
 0 Comments










ABOUT THE AUTHOR









Threat Intelligence Team













Contributors



Threat Center



Podcast



Glossary



Scams










 

					Cyberprotection for every one.					



FOR PERSONAL
Windows Antivirus
Mac Antivirus
Android Antivirus
Free Antivirus
VPN App (All Devices)
Malwarebytes for iOS
SEE ALL

COMPANY
About Us
Contact Us
Careers
News and Press
Blog
Scholarship
Forums
 

FOR BUSINESS
Small Businesses
Mid-size business
Larger Enterprise
Endpoint Protection
Endpoint Detection & Response
Managed Detection and Response (MDR)

FOR PARTNERS
Managed Service Provider (MSP) Program
Resellers

MY ACCOUNT
Sign In


SOLUTIONS
Rootkit Scanner
Trojan Scanner
Virus Scanner
Spyware Scanner
Password Generator
Anti Ransomware Protection

ADDRESS
One Albert Quay2nd FloorCork T12 X8N6Ireland
3979 Freedom Circle12th FloorSanta Clara, CA 95054


LEARN
Malware
Hacking
Phishing
Ransomware
Computer Virus
Antivirus
What is VPN?
 




 Twitter




 Facebook




 LinkedIn




 Youtube




 Instagram




Cybersecurity info you can’t live without
Want to stay informed on the latest news in cybersecurity? Sign up for our newsletter and learn how to protect your computer from threats.


Email Address



















English


Legal
Privacy
Accessibility
Vulnerability Disclosure
Terms of Service
 
						© 2024 All Rights Reserved						










Select your language








































