# Reference for threat actor for "APT 3, Gothic Panda, Buckeye"

**Title**: Operation Clandestine Wolf – Adobe Flash Zero-Day in APT3 Phishing Campaign | Mandiant

**Source**: https://www.fireeye.com/blog/threat-research/2015/06/operation-clandestine-wolf-adobe-flash-zero-day.html

## Content
Operation Clandestine Wolf – Adobe Flash Zero-Day in APT3 Phishing Campaign | Mandiant   Skip to main content Mandiant is now part of Google Cloud. Learn More.         Platform   Solutions   Intelligence   Services   Resources   Company Mandiant AdvantageExplore our multi-vendor XDR platform, delivering Mandiant products and integrating with a range of leading security operations technology.Explore the platformarrow_forward Who's targeting you   Attack Surface Management Map your external environment   Breach Analytics for Chronicle Know what we know when we know it   Security Validation Validate controls are working properly   Threat Intelligence Access latest intel from the frontlines   Digital Threat Monitoring Visibility into deep, dark, and open web   Managed Defense Managed detection and response Mandiant SolutionsSolve your toughest cyber security challenges with combinations of products and services.Featured solutionsarrow_forwardBy use casearrow_forwardBy industryarrow_forward  Featured solutions   Proactive Exposure Management New!Reduce exposures before adversaries act   Government New!Protect national services and agencies   Digital Risk ProtectionPrioritize and focus on threats that matter   RansomwareIncrease resilience against ransomware and multifaceted extortion   Know Who is Targeting YouPrioritize threats that matter most   Know What Is ExposedIdentify attack surface exposures   Know If You Are PreparedTest and measure your cyber defense program   Know If You Have Been BreachedDetect and respond to breach activity quickly and effectively   Use Case   RansomwareIncrease resilience against multifaceted extortion   Cyber Risk ManagementAdvance your business approach to cyber security   Digital Risk ProtectionPrioritize and focus on threats that matter   Industrial ControlsStrengthen OT and ICS security   Insider ThreatsUncover and manage internal vulnerabilities   Skills GapClose gaps with training and access to expertise   Private Industry   Finance New!Extend your security posture and operationalize resilience   Manufacturing New!Protect against cyber security threats to maintain business continuity   Government   Election SecurityFocus on Election Infrastructure Protection   Government  New!Protect natural services and agencies Mandiant ServicesMitigate threats, reduce risk, and get back to business with the help of leading experts.Learn morearrow_forwardView all services (47)arrow_forward Schedule a consultation   Featured categories   Cyber Security Transformation Establish and activate cyber defenses   Incident Response Tackle breaches confidently   Strategic Readiness Increase resilience to risk   Technical Assurance Test your security program   Expertise On Demand Access to Mandiant Experts   Training   Browse courses Browse on-demand and live training   Mandiant Academy Train your teams to protect effectively Cyber Threat IntelligenceMandiant specializes in cyber threat intelligence, offering products, services, and more to support our mission to defend against cyber crime. Intelligence resourcesarrow_forward  Products   Threat Intelligence Access latest intel from the frontlines   Digital Threat Monitoring visibility into deep, dark, and open web   Services   Intelligence capability development build a comprehensive threat intelligence program   Intelligence Training Develop practical application skills   Executive Briefings Get live, interactive briefings from the frontlines   Advanced Intelligence Access Hire a dedicated analyst for your needs Resource CenterGet the latest insights from cyber security experts at the frontlines of threat intelligence and incident responseM-Trends 2023 reportarrow_forwardmWISEarrow_forward View all resourcesarrow_forward   Resource types   Mandiant Blog Expert perspectives and industry news   Podcasts Interviews, hot topics, and more   Customer Stories Case studies and customer testimonials   Reports Research from the frontlines   Webinars Livestreams and pre-recorded speaker events   Insights Cyber security concepts, methods, and more   Events Upcoming conferences and collaboration   Infographics Visualization of security research and process   Datasheets Information on Mandiant offerings and more   eBooks High-impact cyber security guides   White Papers Cyber security insights and technical expertise CompanyLearn more about us and our mission to help organizations defend against cyber crime.Learn morearrow_forward Contact us   Careers Life at Mandiant and open roles   Media Center Press releases and news mentions   Partners Ecosystem and resources   Elevate Empowering women in cyber security   Mandiant Gives Back Our commitment to a better future              Sign in to Advantage  en  expand_more   English Français Deutsch Italiano 日本 한국어 EspañolGet Started        Search   Submit search form    Search   Submit search form  PlatformMandiant Advantage OverviewSecurity ValidationAttack Surface ManagementThreat IntelligenceDigital Threat MonitoringManaged DefenseSolutionsProactive Exposure ManagementGovernmentRansomwareKnow Who is Targeting YouKnow What Is ExposedKnow If You Are PreparedKnow If You Have Been BreachedCyber Risk ManagementDigital Risk ProtectionOT/ICS SecurityInsider ThreatsCyber Security Skills GapFinanceManufacturingElection SecurityIntelligenceIntelligence resourcesThreat IntelligenceDigital Threat MonitoringIntelligence Capability DevelopmentIntelligence TrainingExecutive BriefingsAdvanced Intelligence AccessServicesServices OverviewIncident ResponseStrategic ReadinessCyber Security TransformationTechnical AssuranceView all Services (48)Mandiant AcademyFind a CourseExpertise On DemandResourcesResourcesMandiant BlogsCustomer StoriesWebinarsEventsPodcastsReportsInsightsDatasheetsInfographicsWhite PaperseBooksCompanyAbout MandiantCareersMedia CenterPartnersElevateMandiant Gives BackMobile Footer SectionSee what’s new at MandiantGet startedIncident Response HelpContact SalesSupportBlogTop Incident Response Contact sales Support   BlogSupportContact usreport_problemIncident Response Assistance   Breadcrumb Home Operation Clandestine Wolf – Adobe Flash Zero-Day in APT3 Phishing Campaign   Threat Research Operation Clandestine Wolf – Adobe Flash Zero-Day in APT3 Phishing CampaignErica Eng, Dan Caselden Jun 23, 20157 min read |    Last updated: Nov 04, 2021 Zero Day ThreatsIn June, FireEye’s FireEye as a Service team in Singapore uncovered a phishing campaign exploiting an Adobe Flash Player zero-day vulnerability (CVE-2015-3113). The attackers’ emails included links to compromised web servers that served either benign content or a malicious Adobe Flash Player file that exploits CVE-2015-3113.Adobe has already released a patch for CVE-2015-3113 with an out-of-band security bulletin (https://helpx.adobe.com/security/products/flash-player/apsb15-14.html). FireEye recommends that Adobe Flash Player users update to the latest version as soon as possible.FireEye MVX detects this threat as a web infection, the IPS engine reports the attack as CVE-2015-3113, and the SHOTPUT backdoor is reported as Backdoor.APT.CookieCutter.APT3The China-based threat group FireEye tracks as APT3, aka UPS, is responsible for this exploit and the activity identified in our previous blog post, Operation Clandestine Fox. This group is one of the more sophisticated threat groups that FireEye Threat Intelligence tracks, and they have a history of introducing new browser-based zero-day exploits (e.g., Internet Explorer, Firefox, and Adobe Flash Player). After successfully exploiting a target host, this group will quickly dump credentials, move laterally to additional hosts, and install custom backdoors. APT3’s command and control (CnC) infrastructure is difficult to track, as there is little overlap across campaigns.Activity OverviewIn the last several weeks, APT3 actors launched a large-scale phishing campaign against organizations in the following industries:Aerospace and DefenseConstruction and EngineeringHigh TechTelecommunicationsTransportationUpon clicking the URLs provided in the phishing emails, targets were redirected to a compromised server hosting JavaScript profiling scripts. Once a target host was profiled, victims downloaded a malicious Adobe Flash Player SWF file and an FLV file, detailed below. This ultimately resulted in a custom backdoor known as SHOTPUT, detected by FireEye as Backdoor.APT.CookieCutter, being delivered to the victim’s system.The payload is obscured using xor encoding and appended to a valid GIF file. Attack VectorThe phishing emails used by APT3 during this campaign were extremely generic in nature, almost appearing to be spam. An example email body:Save between $200-450 by purchasing an Apple Certified Refurbished iMac through this link. Refurbished iMacs come with the same 1-year extendable warranty as new iMacs. Supplies are limited, but update frequently.Don't hesitate . . .>Go to SaleThe string “>Go to Sale” was a link that used the following URL structure:hxxp://<subdomain>.<legitdomain>.<TLD>/<directory>/<alphanumericID>.htmlExploit DetailsThe attack exploits an unpatched vulnerability in the way Adobe Flash Player parses Flash Video (FLV) files. The exploit uses common vector corruption techniques to bypass Address Space Layout Randomization (ASLR), and uses Return-Oriented Programming (ROP) to bypass Data Execution Prevention (DEP).  A neat trick to their ROP technique makes it simpler to exploit and will evade some ROP detection techniques.Shellcode is stored in the packed Adobe Flash Player exploit file alongside a key used for its decryption. The payload is xor encoded and hidden inside an image.Exploit PackagingThe Adobe Flash Player exploit is packed with a simple RC4 packer. The RC4 key and ciphertext are BinaryData blobs that the packer uses to decrypt the layer 2 Adobe Flash Player file. Once decrypted, layer 2 is executed with loader.loadBytes.Vector CorruptionLayer 2 uses a classic Adobe Flash Player Vector corruption technique to develop its heap corruption vulnerability to a full relative read/write available to ActionScript3. In this technique, the attacker sprays Adobe Flash Player Vectors to the heap, and triggers a write vulnerability to change the size of one of the vectors. The attacker can then perform subsequent reads and writes to memory outside the intended boundaries of the corrupted Vector object from AS3. For more details on this technique, see Flash in 2015.Once the attacker has limited read/write access to memory, they choose to corrupt a second Vector to increase their access to a range of 0x3fffffff bytes. This second Vector is used for the remainder of the exploit.Return-Oriented ProgrammingThe attackers use a ROP chain to call kernel32!VirtualAlloc to mark their shellcode as executable before jumping to their shellcode.Instead of writing their ROP chain to the heap along with their shellcode and payload, they used a different technique. Usually, exploit developers will corrupt a built-in Adobe Flash Player object such as a Sound object. Instead, the attackers chose to define their own class in AS3 with a function that takes a lot of arguments:class CustomClass {    public function victimFunction(arg1:uint, arg2:uint, …, arg80:uint):uint}Then, the attackers can simply overwrite the function pointer with a gadget that adds to the stack pointer and returns to pivot to ROP. They have no need to identify the absolute address of the ROP chain and preserve it in a register for a typical xchg reg32, esp pivot. Additionally, storing the ROP chain on the stack will evade ROP detection mechanisms designed around detecting when the stack pointer points outside of a thread’s stack region.this.customObj.victimFunction(6f73b68b, // ret; (ROPsled)…,6f73b68a, //pop eax1f140100,6fd36da1, //call Kernel32!VirtualAlloc(0x1f140000, 0x10000, 0x1000, 0x40)1f140000, // Address00010000, // Size00001000, // Type00000040, // Protection = RWX6f73b68b*9 // ret (ROPsled)6fd36da7*2 // ret6f73aff0 pop ecx6fd36da76fd36da7 jmp [eax]…)this.customObj.victimFunction pointer modified to:00000000`6de533dc 5e          pop     rsi00000000`6de533dd 83c448      add     esp,48h00000000`6de533e0 c3          retLastly, the ROP chain has a ROPsled following the call to VirtualAlloc. This could just be an artifact of development, or it could be designed to bypass detection mechanisms that test for valid return addresses up to a limited depth at calls to VirtualAlloc.Full Exploit Flow1.     Create a new Video object2.     Fetch the payload3.     Attach the video to a new NetStream4.     Spray the heap with Adobe Flash Player Vectors        a.     Create a Vector containing 98688 Vectors containing 1022 uints        b.     Set the first two dwords in each Vector<uint> to 0x41414141, 0x424242425.     Create holes for the controlled FLV object        a.     Free approximately every 3rd Vector in the spray6.     Spray custom class objects for future control transfer        a.     Define a new class CustomClass                i.     Define a function victimFunction with lots of arguments        b.     Create a Vector of 0x100 Vectors of 1007 references to an CustomClass instance7.     Fetch and play the FLV exploit        a.     The FLV file will allocate an attacker controlled object in one of the holes from step 5        b.     The attacker controlled object will overwrite the length field of an adjacent vector8.     Re-fill holes from step 5 with Vectors as in step 49.     Find the corrupted vector        a.     Search through Vectors from step 4        b.     Check the length of each Vector to find one that is abnormally large10.  Corrupt a second Vector (Vector2)        a.     Using the corrupted Vector from step 9 to read/write relative memory addresses                i.     Search memory for an adjacent vector                ii.     Overwrite the length field with 0x3fffffff                iii.     Verify that a corrupted vector with length 0x3fffffff now exists in the spray                        1.     If not, undo corruption and attempt to corrupt the next vector11.  Decrypt shellcode and store it and the payload on the heap12.  Overwrite the CustomClass.victimFunction function pointer        a.     Find the sprayed CustomClass object instance references from step 6        b.     The new function is a form of “pivot” that transfers control to the attacker13.  Build ROP chain on the stack and call it        a.     Find ROP gadgets in memory using Vector2                i.     Including a call to kernel32!VirtualAlloc        b.     Call the corrupted CustomClass.victimFunction from step 6.a.i                i.     Arguments to the function are the gadgets of the ROP chain                ii.     They are conveniently pushed onto the stack                iii.     Corrupted vtable from step 12 calls a pivot                        1.     The “pivot” just adds to to the stack pointer and returns because the ROP chain is on                                the stack14.  ROP chain calls shellcode        a.     Call kernel32!VirtualAlloc        b.     jmp to shellcode15.  Shellcode calls payload        a.     Shellcode searches memory for the payload, which is stored inside an image        b.     Shellcode decodes the payload by xoring each byte (that is not 0 or 0x17) with 0x17ConclusionOnce APT3 has access to a target network, they work quickly and they are extremely proficient at enumerating and moving laterally to maintain their access. Additionally, this group uses zero-day exploits, continually updated custom backdoors, and throwaway CnC infrastructure, making it difficult to track them across campaigns.AcknowledgementsThank you to the following contributors to this blog!·      Joseph Obed, Ben Withnell, Kevin Zuk, Genwei Jiang, and Corbin Souffrant of FireEye Link to RSS feedPrepare for 2024's cybersecurity landscape.Get the Google Cloud Cybersecurity Forecast 2024 report to explore the latest trends on the horizon. Download now  Have questions? Let's talk.Mandiant experts are ready to answer your questions. Contact Us  Follow us Footer Mandiant Advantage Platform Platform Overview Security Validation Attack Surface Management Threat Intelligence Digital Threat Monitoring Managed Defense Solutions Proactive Exposure Management Ransomware Industrial Controls & OT Cyber Risk Management Digital Risk Protection Insider Threats Cyber Security Skills Gap Election Security Government Cyber Security Manufacturing Cyber Threat Visibility Attack Surface Visibility Cyber Preparedness Detection and Response Financial Services Cyber Security Services Services Overview Incident Response Strategic Readiness Cyber Security Transformation Technical Assurance View all Services (48) Expertise on Demand Mandiant Academy Overview Education Formats Upcoming Courses On-Demand Courses Certifications ThreatSpace Cyber Range Free Course Sneak Peaks Resources Resource Center Blog Podcasts  Customer Stories Reports Webinars Insights eBooks Infographics White Papers Datasheets Company About Us Careers Events Media Center Partners Partners Overview Technology Partners Cyber Risk Partners Service Partners Channel Partners Partner Portal Connect with Mandiant Contact Us Report an Incident Customer Support Customer Success Media Inquiries © Copyright 2024 Mandiant. All rights reserved.Bottom Website Privacy Policy Terms & Conditions Compliance Site Map  